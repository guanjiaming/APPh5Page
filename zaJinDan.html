<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>砸金蛋</title>
    <meta http-equiv="X-UA-Compatible" content="edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no"/>
    <link rel="stylesheet" href="css/zaJinDan/style.css"/>
    <link rel="stylesheet" href="css/zaJinDan/main_response.css"/>
</head>
<body>
<div class="loadingDiv" id="loadingDiv">
    <p class="wiatTitle">请稍等...</p>
</div>
<div class="goldContent">
    <div class="headPage">
        <img class="headPage_Img" src="images/zaJinDan/banner.jpg" alt="砸金蛋" title="砸金蛋"/>
    </div>
    <div class="goldEggsDiv">
        <img class="centerPage_Img" src="images/zaJinDan/conimg.jpg" alt="砸金蛋" title="砸金蛋"/>
        <div class="myjifen">
            <span>我的积分<i class="integralNum">88888</i></span>
        </div>
        <div class="list_EggsDiv" id="carousel">
            <div>
                <ul class="jinDanUl" id="jinDanUl1">
                    <li><img src="images/zaJinDan/eggs.png" alt="egg1" title="快来砸我呀！"/></li>
                    <li><img src="images/zaJinDan/eggs.png" alt="egg2" title="快来砸我呀！"/></li>
                    <li><img src="images/zaJinDan/eggs.png" alt="egg3" title="快来砸我呀！"/></li>
                </ul>
            </div>
            <div>
                <ul class="jinDanUl1" id="jinDanUl2">
                    <li><img src="images/zaJinDan/eggs.png" alt="egg4" title="快来砸我呀！"/></li>
                    <li><img src="images/zaJinDan/eggs.png" alt="egg5" title="快来砸我呀！"/></li>
                    <li><img src="images/zaJinDan/eggs.png" alt="egg6" title="快来砸我呀！"/></li>
                </ul>
            </div>
        </div>
    </div>
</div>
</body>
<script src="js/getWddjUrl.js"></script>
<script src="js/base64.js"></script>
<script data-main="js/zaJinDan/do_main.js" src="js/zaJinDan/jquery-2.1.0.min.js"></script>
<script src="js/zaJinDan/require.js"></script>
<script src="js/phone.js"></script>
<script>
    $(function () {
        /**
         * 此方法用来获取url参数
         * 示例：var oToken = $.getUrlParam('token');
         * 依赖于jquery，必须放在最前面
         */
        (function ($) {
            $.getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }
        })(jQuery);

        //获取token
        var oToken = $.getUrlParam('token');
//        var oToken = "B1162BDE2D1A6A3AB97C6A3437A94F7F";
        localStorage.oToken = oToken;
        var oHttp = getWddjUrl();
        localStorage.oHttp = oHttp;
        var base = new Base64();

        //获取奖品列表
        getProduct(oHttp, 3, oToken);
        //获取用户积分,并展示到页面
        getIntegral(oHttp, oToken, base);

        /**
         * 获取用户剩余积分
         * @param oHttp
         * @param oToken
         * @param base
         * @param callback
         */
        function getIntegral(oHttp, oToken, base, callback) {
            var data = {"token": oToken};
            var baseData = base.encode(JSON.stringify(data));
            //去掉特殊的斜杠，已保证url地址的正确性
            baseData = baseData.replace(new RegExp("/", "gm"), "*");
            //拼接参数
            var url = "/luckGame/getIntegral/";
            url = oHttp + url + baseData;
//            console.log(url);
            $.ajax({
                url: url,
                type: "POST",
                success: function (res) {
                    res = JSON.parse(res);
//                    console.log(res);
                    if (res.code == 1) {
                        //设置页面上的积分数为后台请求过来的
                        $(".myjifen .integralNum").text(res.resData.integral);
                    }
                    if (callback) callback();
                },
                error: function (err) {
                    console.log(err);
                }
            })
        }

        /**
         * 请求奖品列表数据
         * @param oHttp
         * @param level
         * @param token
         */
        function getProduct(oHttp, level, token) {
            var data = {"level": level, "token": token};
            var baseData = base.encode(JSON.stringify(data));
            //去掉特殊的斜杠，已保证url地址的正确性
            baseData = baseData.replace(new RegExp("/", "gm"), "*");
            //拼接参数
            var url = "/luckGame/data/";
            url = oHttp + url + baseData;

            $.ajax({
                url: url,
                type: "GET",
                success: function (res) {
//                    console.log(JSON.parse(res));
//                console.log(JSON.parse(res));   //code: 1, msg: "请求成功", resData: Array(4)
                },
                error: function (err) {
                    console.log(JSON.parse(err));
                }
            })
        }

    });
</script>
</html>